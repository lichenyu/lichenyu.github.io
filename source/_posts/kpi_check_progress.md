title: KPI Check Progress
date: 2018/10/10
categories:
- Data Analysis
tags:
- KPI Check
---


## 0. 数据预处理 ##

### 数据读取 ###


## 1. 训练数据预处理 ##

### 1.1. 各天数据校验 ###

- 按天为周期尽可能多的截取训练数据。判断每个周期内缺失点的数量是否超过2%，如超过则将该周期剔除。
- 剔除异常周期之后，如果能够用于训练的数据周期数小于阈值（4天/周），无法训练。
- 线性插值，补NaN点。


### 1.2. LOF ###

训练数据中（要做阈值选取）不想有异常。因而，进一步使用LOF及滤波，去除异常点。


### 1.3. 滤波 ###

与大毛刺检测是一致的。


### 1.4. 去除异常点后检查 ###

- 如果异常点的个数超过15%，则将异常周期剔除，否则只将异常点剔除。
- 剔除异常周期之后，如果能够用于训练的数据周期数小于阈值（4天/周），无法训练。
- 线性插值，补异常点。
- 保存去除异常点后的滤波结果，可能用于后续的大毛刺检测。？？？


## 2. 周期性检测 ##

利用自相关函数来进行判断

1. 将N天的数据拼接？？？
2. ？？？


## 3. 异常检测 ##

处理的对象是什么？计算的指标是什么？训练获取的是什么？检测时怎么做？


### 3.1. 周期性数据 ###

#### [点对点] ####

|||
|---|---|
|**对象**|各周期同一时刻的数据点|
|**处理法**|确定两个固定的阈值，在此范围外的点为异常。|
|**核心思想**|周期性数据，不同天同一时刻的数据点，取值应该相差不大。|

- 直接统计**同一时刻数据点原始数据**。
- 训练：根据训练数据（注意：训练数据都是经过滤波后的，下同）的均值和方差，计算$\mu \pm k \times \sigma$阈值。
  - 如果sigma是0，就按均值的10%来设置阈值。
- 检测：检测数据，若在阈值之外，则认为是异常。
  - 若异常点连续出现，则认为检出异常，否则进行抑制。


#### [FFT] ####

|||
|---|---|
|**对象**|各周期同一时刻的数据点及其前几个点，作为时间窗|
|**处理法**|同时刻时间窗做FFT，互相对比统计分布。|
|**核心思想**|周期性数据，不同天同一时刻（时间窗）的数据点，在频域的统计分布上应该相差不大。|

- 同一时刻的数据点及其前几个点作为**时间窗**，做FFT。
- 训练：FFT结果？？？
- 检测：使用KS检验对训练数据的频域分布和检测数据的频域分布进行对比，若两者来自同一分布的程度大，则认为是正常，否则为异常。


#### [最小值] ####

|||
|---|---|
|**对象**|所有数据点|
|**处理法**|确定一个最小阈值，在此值以下的点为异常。|
|**核心思想**|（根据历史各周期情况）数据应存在一个不应被超过的下限。|

- 查找每个周期的指标最小值，并对最小值求平均，将平均值的75%或者50%作为阈值。


### 3.2. 非周期性数据 ###

#### [大毛刺] ####

|||
|---|---|
|**对象**|所有数据点|
|**处理法**|确定两个固定的阈值，在此范围外的点为异常。|
|**核心思想**|数据变化应较为平缓。|

- 将**原始数据**与**滤波后数据**，相减并取绝对值。
- 训练：根据训练数据的残余信号的均值和方差，计算$\mu \pm k \times \sigma$阈值。
- 检测：检测数据的残余信号，若在阈值之外，则认为是异常。
  - 多种滤波的结果投票，确定最终检出异常。
  - 若好几个周期都在某个时刻出现异常，则认为是系统的正常波动，对该时刻的检出异常进行抑制。


#### [动态阈值] ####

|||
|---|---|
|**对象**|所有数据点|
|**处理法**|确定两个固定的阈值，在此范围外的点为异常。|
|**核心思想**|各数据点间应该相差不大。|

- 直接统计**原始数据**（区别于大毛刺检测中，存在滤波平滑处理）。
- 训练：根据训练数据的均值和方差，计算$\mu \pm k \times \sigma$阈值。
- 检测：检测数据，若在阈值之外，则认为是异常。


### 3.3. 异常点检测方法总结 ###

从上文可以看出，在KpiCheck中，对于异常点检测，主要使用的方法就是**K-sigma准则取阈值**。

此外，还有离群点检测方法**LOF**，被用于了训练数据预处理。


### 3.4. 所谓的降级检测 ###

